{"title":"Deploy K8S","uid":"6a10bf4989cdd89dde18ea8bad304bb7","slug":"k8s","date":"2021-11-28T15:00:00.000Z","updated":"2022-09-28T07:19:23.110Z","comments":true,"path":"api/articles/k8s.json","keywords":null,"cover":"https://cycling-bucket.oss-cn-shenzhen.aliyuncs.com/littleboy/image-20211128225817137.png","content":"<h1 id=\"三节点-k8s-部署\"><a href=\"#三节点-k8s-部署\" class=\"headerlink\" title=\"三节点 k8s 部署\"></a>三节点 k8s 部署</h1><h2 id=\"1：机器准备\"><a href=\"#1：机器准备\" class=\"headerlink\" title=\"1：机器准备\"></a>1：机器准备</h2><p>这里我们准备三台虚拟机，一台master，二台node</p>\n<p><a href=\"ubuntuKvmBridge\">机器准备教程 ubuntu 搭建 kvm 安装虚拟机</a></p>\n<p><img src=\"https://cycling-bucket.oss-cn-shenzhen.aliyuncs.com/littleboy/image-20211210165252629.png\" alt=\"img.png\"></p>\n<h2 id=\"2：安装前的环境确认\"><a href=\"#2：安装前的环境确认\" class=\"headerlink\" title=\"2：安装前的环境确认\"></a>2：安装前的环境确认</h2><p>所有机器都需要执行：</p>\n<ul>\n<li><p>a：三台机器都可以联网，uname -a查看内核是否大于等于3.1</p>\n</li>\n<li><p>b：关闭三台机器的防火墙</p>\n</li>\n</ul>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl stop firewalld\n\nsystemctl disable firewalld</code></pre>\n\n<ul>\n<li>c：关闭selinux</li>\n</ul>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">sed -i &#39;s&#x2F;enforcing&#x2F;disabled&#x2F;&#39; &#x2F;etc&#x2F;selinux&#x2F;config</code></pre>\n\n<ul>\n<li>d：关闭swap</li>\n</ul>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">swapoff -a\n\nvi &#x2F;etc&#x2F;fstab\n\n# 注释这一行：&#x2F;mnt&#x2F;swap swap swap defaults 0 0\n# 或者 &#x2F;dev&#x2F;mapper&#x2F;centos-swap swap swap defaults 0 0\n# 查看swap是否全为0\n\nfree -m\n              total        used        free      shared  buff&#x2F;cache   available\nMem:           3789         769        2123           9         895        2785\nSwap:             0           0           0</code></pre>\n\n<ul>\n<li>e：配置三台机器的主机名,分别在三台机器上执行命令</li>\n</ul>\n<p>10.100.0.131上执行：hostnamectl set-hostname k8smaster</p>\n<p>10.100.0.196上执行：hostnamectl set-hostname k8snode1</p>\n<p>10.100.0.245上执行：hostnamectl set-hostname k8snode2</p>\n<ul>\n<li>f：在master的机器上添加hosts，在10.100.0.131上执行命令</li>\n</ul>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cat &gt;&gt; &#x2F;etc&#x2F;hosts &lt;&lt; EOF\n\n10.100.0.131 k8smaster\n\n10.100.0.196 k8snode1\n\n10.100.0.245 k8snode2\n\nEOF</code></pre>\n\n<ul>\n<li>g：将桥接的IPV4流量传递到iptables的链，三台机器都执行命令</li>\n</ul>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cat &gt; &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf &lt;&lt; EOF\n\nnet.bridge.bridge-nf-call-ip6tables &#x3D; 1\n\nnet.bridge.bridge-nf-call-iptables &#x3D; 1\n\nEOF</code></pre>\n\n<ul>\n<li>h：所有节点执行命令，生效</li>\n</ul>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">sysctl --system</code></pre>\n\n<ul>\n<li>i：同步每个服务器的时间和时区</li>\n</ul>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">\nyum install ntpdate -y\n\nntpdate time.windows.com\n\ncp &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime</code></pre>\n\n<h2 id=\"3：三台机器全部安装docker\"><a href=\"#3：三台机器全部安装docker\" class=\"headerlink\" title=\"3：三台机器全部安装docker\"></a>3：三台机器全部安装docker</h2><p>所有机器都需安装</p>\n<h3 id=\"3-1：配置阿里云的镜像\"><a href=\"#3-1：配置阿里云的镜像\" class=\"headerlink\" title=\"3.1：配置阿里云的镜像\"></a>3.1：配置阿里云的镜像</h3><pre class=\"line-numbers language-nashorn\" data-language=\"nashorn\"><div class=\"caption\"><span>js</span></div><code class=\"language-nashorn\">wget\nhttp:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo -O &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo</code></pre>\n\n<h3 id=\"3-2：刷新yum源\"><a href=\"#3-2：刷新yum源\" class=\"headerlink\" title=\"3.2：刷新yum源\"></a>3.2：刷新yum源</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum clean all\n\nyum makecache\n\nyum -y update</code></pre>\n\n<h3 id=\"3-3：安装docker\"><a href=\"#3-3：安装docker\" class=\"headerlink\" title=\"3.3：安装docker\"></a>3.3：安装docker</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum -y install docker-ce-18.06.1.ce-3.el7\n\n# 如果之前机器上有安装过，先删除，执行\nyum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-selinux docker-engine-selinux docker-engine</code></pre>\n\n<h3 id=\"3-4：启动docker-并设为开机自启动\"><a href=\"#3-4：启动docker-并设为开机自启动\" class=\"headerlink\" title=\"3.4：启动docker,并设为开机自启动\"></a>3.4：启动docker,并设为开机自启动</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl enable docker &amp;&amp; systemctl start docker</code></pre>\n\n<h2 id=\"4：配置kubeadm-kubelet-kubectl镜像\"><a href=\"#4：配置kubeadm-kubelet-kubectl镜像\" class=\"headerlink\" title=\"4：配置kubeadm,kubelet,kubectl镜像\"></a>4：配置kubeadm,kubelet,kubectl镜像</h2><p>所有机器都需要：</p>\n<p>kubelet：运行在集群所有节点上,负责启动POD和容器</p>\n<p>kubeadm：用于初始化集群</p>\n<p>kubectl：kubenetes命令行工具，通过kubectl可以部署和管理应用，查看各种资源，创建，删除和更新组件</p>\n<h3 id=\"4-1：创建yum源的文件\"><a href=\"#4-1：创建yum源的文件\" class=\"headerlink\" title=\"4.1：创建yum源的文件\"></a>4.1：创建yum源的文件</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cat &gt; kubernetes.repo &lt;&lt; EOF\n\n[kubernetes]\n\nname&#x3D;Kubernetes\n\nbaseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;repos&#x2F;kubernetes-el7-x86_64\n\nenabled&#x3D;1\n\ngpgcheck&#x3D;1\n\nrepo_gpgcheck&#x3D;1\n\ngpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;yum-key.gpg https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;rpm-package-key.gpg\n\nEOF</code></pre>\n\n<h3 id=\"4-2：将文件移到yum的目录\"><a href=\"#4-2：将文件移到yum的目录\" class=\"headerlink\" title=\"4.2：将文件移到yum的目录\"></a>4.2：将文件移到yum的目录</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mv kubernetes.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;</code></pre>\n\n<h2 id=\"5：安装kubeadm-kubelet-kubectl\"><a href=\"#5：安装kubeadm-kubelet-kubectl\" class=\"headerlink\" title=\"5：安装kubeadm,kubelet,kubectl\"></a>5：安装kubeadm,kubelet,kubectl</h2><p>所有机器都需要：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum install -y kubelet-1.17.0 kubeadm-1.17.0 kubectl-1.17.0\n\nsystemctl enable kubelet</code></pre>\n\n<h2 id=\"6：初始化kubeadm-只在master机器上\"><a href=\"#6：初始化kubeadm-只在master机器上\" class=\"headerlink\" title=\"6：初始化kubeadm(只在master机器上)\"></a>6：初始化kubeadm(只在master机器上)</h2><p>只执行master机器10.100.0.131：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubeadm init \\\n\n--apiserver-advertise-address&#x3D;10.100.0.131 \\\n\n--image-repository registry.aliyuncs.com&#x2F;google_containers \\\n\n--kubernetes-version v1.17.0 \\\n\n--service-cidr&#x3D;10.96.0.0&#x2F;12 \\\n\n--pod-network-cidr&#x3D;10.244.0.0&#x2F;16</code></pre>\n\n<h2 id=\"7：将k8s生成的管理员连接k8s集群的配置文件考到它默认的工作目录\"><a href=\"#7：将k8s生成的管理员连接k8s集群的配置文件考到它默认的工作目录\" class=\"headerlink\" title=\"7：将k8s生成的管理员连接k8s集群的配置文件考到它默认的工作目录\"></a>7：将k8s生成的管理员连接k8s集群的配置文件考到它默认的工作目录</h2><p>只执行master机器10.100.0.131：</p>\n<p>这样就可以通过kubectl连接k8s集群了，执行命令：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mkdir -p $HOME&#x2F;.kube\n\nsudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config\n\nsudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config\n\n# 测试：\n\nkubectl get node</code></pre>\n\n<p>8：安装pod网络插件CNI</p>\n<p>只执行master机器10.100.0.131：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl apply -f https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;coreos&#x2F;flannel&#x2F;master&#x2F;Documentation&#x2F;kube-flannel.yml</code></pre>\n\n<p>装好之后执行</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl get pods -n kube-system</code></pre>\n\n<p>等待所有组件状态都为：Running</p>\n<h2 id=\"9：将节点加入集群中\"><a href=\"#9：将节点加入集群中\" class=\"headerlink\" title=\"9：将节点加入集群中\"></a>9：将节点加入集群中</h2><h3 id=\"9-1：执行命令（在master机器上）\"><a href=\"#9-1：执行命令（在master机器上）\" class=\"headerlink\" title=\"9.1：执行命令（在master机器上）\"></a>9.1：执行命令（在master机器上）</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubeadm token list # 查看现在有的token\n\nkubeadm token create # 生成一个新的token\n\nkubeadm token create --ttl 0 # 生成一个永远不过期的token</code></pre>\n\n<h3 id=\"9-2：获取ca证书sha256编码hash值（在master机器上运行）\"><a href=\"#9-2：获取ca证书sha256编码hash值（在master机器上运行）\" class=\"headerlink\" title=\"9.2：获取ca证书sha256编码hash值（在master机器上运行）\"></a>9.2：获取ca证书sha256编码hash值（在master机器上运行）</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">openssl x509 -pubkey -in &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt | openssl rsa -pubin -outform der 2&gt;&#x2F;dev&#x2F;null | openssl dgst -sha256 -hex | sed &#39;s&#x2F;^.* &#x2F;&#x2F;&#39;</code></pre>\n\n<h3 id=\"9-3：加入节点（在要加入的机器上）\"><a href=\"#9-3：加入节点（在要加入的机器上）\" class=\"headerlink\" title=\"9.3：加入节点（在要加入的机器上）\"></a>9.3：加入节点（在要加入的机器上）</h3><p>&lt;&gt;里面的内容替换掉，包括括号</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubeadm join master机器Ip:6443 --token &lt;9.1步查到没过期的token&gt; --discovery-token-ca-cert-hash sha256:&lt;9.2中获取的字符串&gt;</code></pre>\n\n<h3 id=\"9-4：在master机器上执行命令，查看现在的节点情况\"><a href=\"#9-4：在master机器上执行命令，查看现在的节点情况\" class=\"headerlink\" title=\"9.4：在master机器上执行命令，查看现在的节点情况\"></a>9.4：在master机器上执行命令，查看现在的节点情况</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl get nodes</code></pre>\n\n<p>可以看到，刚才加入的二个节点状态是NotReady,是因为它的网络还没有准备好,过几分钟再看，就会变成Read状态</p>\n<h2 id=\"10：部署K8s的管理页面Dashboard\"><a href=\"#10：部署K8s的管理页面Dashboard\" class=\"headerlink\" title=\"10：部署K8s的管理页面Dashboard\"></a>10：部署K8s的管理页面Dashboard</h2><h3 id=\"10-1：在master中执行下列命令：\"><a href=\"#10-1：在master中执行下列命令：\" class=\"headerlink\" title=\"10.1：在master中执行下列命令：\"></a>10.1：在master中执行下列命令：</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl apply -f https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;kubernetes&#x2F;dashboard&#x2F;v2.0.0-beta8&#x2F;aio&#x2F;deploy&#x2F;recommended.yaml</code></pre>\n\n<h3 id=\"10-2：\"><a href=\"#10-2：\" class=\"headerlink\" title=\"10.2：\"></a>10.2：</h3><p>默认Dashboard只能集群内部访问，需要修改service为nodePort类型，暴露到外部，执行命令将配置文件下载下来</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;kubernetes&#x2F;dashboard&#x2F;v2.0.0-beta8&#x2F;aio&#x2F;deploy&#x2F;recommended.yaml</code></pre>\n\n<h3 id=\"10-3：修改这个文件\"><a href=\"#10-3：修改这个文件\" class=\"headerlink\" title=\"10.3：修改这个文件\"></a>10.3：修改这个文件</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">vim recommended.yaml</code></pre>\n\n<p>找到这段，增加红包部分，冒号后面有一个空格，千万要注意</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\">spec:\n  # 添加 type\n  type: NodePort\n  ports:\n    - port: 443\n      targetPort: 8443\n      # 添加nodePort，可以自定义\n      nodePort: 30001\n  selector:\n    k8s-app: kubernetes-dashboard</code></pre>\n\n<h3 id=\"10-4：重新加载运行配置文件\"><a href=\"#10-4：重新加载运行配置文件\" class=\"headerlink\" title=\"10.4：重新加载运行配置文件\"></a>10.4：重新加载运行配置文件</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl apply -f recommended.yaml</code></pre>\n\n<h2 id=\"11：访问k8s管理页面\"><a href=\"#11：访问k8s管理页面\" class=\"headerlink\" title=\"11：访问k8s管理页面\"></a>11：访问k8s管理页面</h2><p><a href=\"https://master机器ip:30001/\">https://master机器ip:30001</a></p>\n<p>注意：这里必须是https的方式，如果谷哥浏览器不能访问，谷哥有的版本没有添加信任的地方，无法访问，可使用firefox或者其它浏览器。</p>\n<h2 id=\"12：创建默认service-account并绑定默认cluster-admin管理员集群角色\"><a href=\"#12：创建默认service-account并绑定默认cluster-admin管理员集群角色\" class=\"headerlink\" title=\"12：创建默认service account并绑定默认cluster-admin管理员集群角色\"></a>12：创建默认service account并绑定默认cluster-admin管理员集群角色</h2><h3 id=\"12-1：在master机器上执行命令：\"><a href=\"#12-1：在master机器上执行命令：\" class=\"headerlink\" title=\"12.1：在master机器上执行命令：\"></a>12.1：在master机器上执行命令：</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">kubectl create serviceaccount dashboard-admin -n kube-system\n\nkubectl create clusterrolebinding dashboard-admin --clusterrole&#x3D;cluster-admin --serviceaccount&#x3D;kube-system:dashboard-admin\n\nkubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk &#39;&#x2F;dashboard-admin&#x2F;&#123;print $1&#125;&#39;)</code></pre>\n\n<h3 id=\"12-2：将生成的token复制到页面就可以登陆了\"><a href=\"#12-2：将生成的token复制到页面就可以登陆了\" class=\"headerlink\" title=\"12.2：将生成的token复制到页面就可以登陆了\"></a>12.2：将生成的token复制到页面就可以登陆了</h3><h2 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h2><h3 id=\"注意一\"><a href=\"#注意一\" class=\"headerlink\" title=\"注意一\"></a>注意一</h3><p>如果虚拟机重启，把第2点（安装前环境确认）中的 a，b，c，d 重新执行一遍，k8s集群会自动重启</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl stop firewalld\nsystemctl disable firewalld\nsed -i &#39;s&#x2F;enforcing&#x2F;disabled&#x2F;&#39; &#x2F;etc&#x2F;selinux&#x2F;config\nswapoff -a\nsysctl --system\nntpdate time.windows.com\ncp &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime</code></pre>\n\n<h3 id=\"注意二\"><a href=\"#注意二\" class=\"headerlink\" title=\"注意二\"></a>注意二</h3><p>Dashboard 在 Safari 无法打开，FireFox 可以打开。</p>\n<p>Chrome 需要界面输入 <code>thisisunsafe</code> ，回车后可以强制打开。</p>\n","feature":true,"text":"三节点 k8s 部署1：机器准备这里我们准备三台虚拟机，一台master，二台node 机器准备教程 ubuntu 搭建 kvm 安装虚拟机 2：安装前的环境确认所有机器都需要执行： a：三台机器都可以联网，uname -a查看内核是否大于等于3.1 b：关闭三台机器的防火墙 s...","link":"","photos":[],"count_time":{"symbolsCount":"5.9k","symbolsTime":"5 mins."},"categories":[{"name":"教程","slug":"教程","count":5,"path":"api/categories/教程.json"}],"tags":[{"name":"K8S","slug":"K8S","count":1,"path":"api/tags/K8S.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%89%E8%8A%82%E7%82%B9-k8s-%E9%83%A8%E7%BD%B2\"><span class=\"toc-text\">三节点 k8s 部署</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1%EF%BC%9A%E6%9C%BA%E5%99%A8%E5%87%86%E5%A4%87\"><span class=\"toc-text\">1：机器准备</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2%EF%BC%9A%E5%AE%89%E8%A3%85%E5%89%8D%E7%9A%84%E7%8E%AF%E5%A2%83%E7%A1%AE%E8%AE%A4\"><span class=\"toc-text\">2：安装前的环境确认</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3%EF%BC%9A%E4%B8%89%E5%8F%B0%E6%9C%BA%E5%99%A8%E5%85%A8%E9%83%A8%E5%AE%89%E8%A3%85docker\"><span class=\"toc-text\">3：三台机器全部安装docker</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-1%EF%BC%9A%E9%85%8D%E7%BD%AE%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E9%95%9C%E5%83%8F\"><span class=\"toc-text\">3.1：配置阿里云的镜像</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-2%EF%BC%9A%E5%88%B7%E6%96%B0yum%E6%BA%90\"><span class=\"toc-text\">3.2：刷新yum源</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-3%EF%BC%9A%E5%AE%89%E8%A3%85docker\"><span class=\"toc-text\">3.3：安装docker</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-4%EF%BC%9A%E5%90%AF%E5%8A%A8docker-%E5%B9%B6%E8%AE%BE%E4%B8%BA%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8\"><span class=\"toc-text\">3.4：启动docker,并设为开机自启动</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4%EF%BC%9A%E9%85%8D%E7%BD%AEkubeadm-kubelet-kubectl%E9%95%9C%E5%83%8F\"><span class=\"toc-text\">4：配置kubeadm,kubelet,kubectl镜像</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-1%EF%BC%9A%E5%88%9B%E5%BB%BAyum%E6%BA%90%E7%9A%84%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">4.1：创建yum源的文件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-2%EF%BC%9A%E5%B0%86%E6%96%87%E4%BB%B6%E7%A7%BB%E5%88%B0yum%E7%9A%84%E7%9B%AE%E5%BD%95\"><span class=\"toc-text\">4.2：将文件移到yum的目录</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#5%EF%BC%9A%E5%AE%89%E8%A3%85kubeadm-kubelet-kubectl\"><span class=\"toc-text\">5：安装kubeadm,kubelet,kubectl</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#6%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96kubeadm-%E5%8F%AA%E5%9C%A8master%E6%9C%BA%E5%99%A8%E4%B8%8A\"><span class=\"toc-text\">6：初始化kubeadm(只在master机器上)</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#7%EF%BC%9A%E5%B0%86k8s%E7%94%9F%E6%88%90%E7%9A%84%E7%AE%A1%E7%90%86%E5%91%98%E8%BF%9E%E6%8E%A5k8s%E9%9B%86%E7%BE%A4%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%80%83%E5%88%B0%E5%AE%83%E9%BB%98%E8%AE%A4%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95\"><span class=\"toc-text\">7：将k8s生成的管理员连接k8s集群的配置文件考到它默认的工作目录</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#9%EF%BC%9A%E5%B0%86%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4%E4%B8%AD\"><span class=\"toc-text\">9：将节点加入集群中</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#9-1%EF%BC%9A%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%EF%BC%88%E5%9C%A8master%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%89\"><span class=\"toc-text\">9.1：执行命令（在master机器上）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#9-2%EF%BC%9A%E8%8E%B7%E5%8F%96ca%E8%AF%81%E4%B9%A6sha256%E7%BC%96%E7%A0%81hash%E5%80%BC%EF%BC%88%E5%9C%A8master%E6%9C%BA%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8C%EF%BC%89\"><span class=\"toc-text\">9.2：获取ca证书sha256编码hash值（在master机器上运行）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#9-3%EF%BC%9A%E5%8A%A0%E5%85%A5%E8%8A%82%E7%82%B9%EF%BC%88%E5%9C%A8%E8%A6%81%E5%8A%A0%E5%85%A5%E7%9A%84%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%89\"><span class=\"toc-text\">9.3：加入节点（在要加入的机器上）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#9-4%EF%BC%9A%E5%9C%A8master%E6%9C%BA%E5%99%A8%E4%B8%8A%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%EF%BC%8C%E6%9F%A5%E7%9C%8B%E7%8E%B0%E5%9C%A8%E7%9A%84%E8%8A%82%E7%82%B9%E6%83%85%E5%86%B5\"><span class=\"toc-text\">9.4：在master机器上执行命令，查看现在的节点情况</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#10%EF%BC%9A%E9%83%A8%E7%BD%B2K8s%E7%9A%84%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2Dashboard\"><span class=\"toc-text\">10：部署K8s的管理页面Dashboard</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#10-1%EF%BC%9A%E5%9C%A8master%E4%B8%AD%E6%89%A7%E8%A1%8C%E4%B8%8B%E5%88%97%E5%91%BD%E4%BB%A4%EF%BC%9A\"><span class=\"toc-text\">10.1：在master中执行下列命令：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#10-2%EF%BC%9A\"><span class=\"toc-text\">10.2：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#10-3%EF%BC%9A%E4%BF%AE%E6%94%B9%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">10.3：修改这个文件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#10-4%EF%BC%9A%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E8%BF%90%E8%A1%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">10.4：重新加载运行配置文件</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#11%EF%BC%9A%E8%AE%BF%E9%97%AEk8s%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2\"><span class=\"toc-text\">11：访问k8s管理页面</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#12%EF%BC%9A%E5%88%9B%E5%BB%BA%E9%BB%98%E8%AE%A4service-account%E5%B9%B6%E7%BB%91%E5%AE%9A%E9%BB%98%E8%AE%A4cluster-admin%E7%AE%A1%E7%90%86%E5%91%98%E9%9B%86%E7%BE%A4%E8%A7%92%E8%89%B2\"><span class=\"toc-text\">12：创建默认service account并绑定默认cluster-admin管理员集群角色</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#12-1%EF%BC%9A%E5%9C%A8master%E6%9C%BA%E5%99%A8%E4%B8%8A%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%EF%BC%9A\"><span class=\"toc-text\">12.1：在master机器上执行命令：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#12-2%EF%BC%9A%E5%B0%86%E7%94%9F%E6%88%90%E7%9A%84token%E5%A4%8D%E5%88%B6%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%99%BB%E9%99%86%E4%BA%86\"><span class=\"toc-text\">12.2：将生成的token复制到页面就可以登陆了</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9\"><span class=\"toc-text\">注意事项</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%E4%B8%80\"><span class=\"toc-text\">注意一</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B3%A8%E6%84%8F%E4%BA%8C\"><span class=\"toc-text\">注意二</span></a></li></ol></li></ol></li></ol>","author":{"name":"SKY","slug":"sky","avatar":"https://cycling-bucket.oss-cn-shenzhen.aliyuncs.com/littleboy/image-20211223171018733.png","link":"/","description":"Welcome to sky home","socials":{"github":"https://github.com/littleboyfury","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/qq_38916811","juejin":"https://juejin.cn/user/2049948533144104","customs":{}}},"mapped":true,"prev_post":{"title":"Functional Programming","uid":"f1c5db41d78c24c5668189654926ca28","slug":"functionalProgramming","date":"2021-12-10T03:00:00.000Z","updated":"2022-09-28T07:19:23.108Z","comments":true,"path":"api/articles/functionalProgramming.json","keywords":null,"cover":"https://cycling-bucket.oss-cn-shenzhen.aliyuncs.com/littleboy/image-20211212224316297.png","text":"Functional Programming什么是函数式编程函数式编程的思维方式：把显示世界的事务和事物之间的联系抽象到程序世界（对运算过程进行抽象） 函数式编程中的函数指的数学中的函数即映射关系，输入的值对应一个输出的值，例如 y = f(x) 相同的输入始终得到相同的输出（纯...","link":"","photos":[],"count_time":{"symbolsCount":"18k","symbolsTime":"16 mins."},"categories":[{"name":"JavaScript","slug":"JavaScript","count":9,"path":"api/categories/JavaScript.json"}],"tags":[{"name":"JAVASCRIPT","slug":"JAVASCRIPT","count":14,"path":"api/tags/JAVASCRIPT.json"}],"author":{"name":"SKY","slug":"sky","avatar":"https://cycling-bucket.oss-cn-shenzhen.aliyuncs.com/littleboy/image-20211223171018733.png","link":"/","description":"Welcome to sky home","socials":{"github":"https://github.com/littleboyfury","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/qq_38916811","juejin":"https://juejin.cn/user/2049948533144104","customs":{}}}},"next_post":{"title":"ubuntu20.04搭建kvm_bridge网桥教程","uid":"d151387cde5693b6d054d4b81d0393bc","slug":"ubuntuKvmBridge","date":"2021-11-10T16:00:00.000Z","updated":"2022-09-28T07:19:23.112Z","comments":true,"path":"api/articles/ubuntuKvmBridge.json","keywords":null,"cover":"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fgo2live.cn%2Fwp-content%2Fuploads%2F2011%2F05%2F160229075570291.jpg&refer=http%3A%2F%2Fgo2live.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1636906835&t=a94ef405bde0b307b6bc3d5ecfeb896c","text":"前提主机配置如下： 电脑为笔记本 处理器 intel i5-6300 HQ 2.30GHz * 4 内存 16G 硬盘 500G 固态 系统 Ubuntu 20.04.3 LTS 64-bit 检查检查CPU是否支持虚拟化$ grep -Eoc &#39;(vmx|svm)&#3...","link":"","photos":[],"count_time":{"symbolsCount":"6.7k","symbolsTime":"6 mins."},"categories":[{"name":"教程","slug":"教程","count":5,"path":"api/categories/教程.json"}],"tags":[{"name":"UBUNTU","slug":"UBUNTU","count":1,"path":"api/tags/UBUNTU.json"},{"name":"KVM","slug":"KVM","count":1,"path":"api/tags/KVM.json"},{"name":"LINUX-BRIDGE","slug":"LINUX-BRIDGE","count":1,"path":"api/tags/LINUX-BRIDGE.json"}],"author":{"name":"SKY","slug":"sky","avatar":"https://cycling-bucket.oss-cn-shenzhen.aliyuncs.com/littleboy/image-20211223171018733.png","link":"/","description":"Welcome to sky home","socials":{"github":"https://github.com/littleboyfury","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/qq_38916811","juejin":"https://juejin.cn/user/2049948533144104","customs":{}}},"feature":true}}